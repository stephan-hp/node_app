<body class="nav-md">

    <div class="container body">
        <div class="main_container">

            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">

                    <div class="navbar nav_title" style="border: 0;">
                        <a href="#" class="site_title"><i class="glyphicon glyphicon-education"></i> <span> EGREX</span></a>
                    </div>
                    <div class="clearfix"></div>

                    <!-- USER INFO -->
                    <div class="profile">
                        <div class="profile_pic">
                            <img src="images/user_img/{{user.user_session_id}}.jpg" alt="..." class="img-circle profile_img">
                        </div>
                        <div class="profile_info">
                            <span>Bienvenido,</span>
                            <h2>{{user.nombre}} {{user.apellidos}} </h2>
                            
                        </div>
                    </div>
                    <!-- /USER INFO -->

                    <br />

                    <!-- sidebar menu -->
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">

                        <div class="menu_section">
                              <!-- ROL NAME -->
                            <h3>Profesor Principal</h3> 
                            <br>
                            <ul class="nav side-menu">
                                <li><a><i class="fa fa-home"></i> Menú <span class="fa fa-chevron-down"></span></a>
                                    <ul class="nav child_menu" style="display: none">
                                        <li><a href="/profesor_principal">Inicio</a>
                                        <li><a href="/profesor_principal_asignar">Gestionar ubicaciones laborales</a>
                                        </li>
                                        <li><a href="/profesor_principal_inconformidades">Consultar inconformidades</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        
                    </div>
                </div>
            </div>

            <!-- top navigation -->
            <div class="top_nav">

                <div class="nav_menu">
                    <nav class="" role="navigation">
                        <div class="nav toggle">
                            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                        </div>

                        <ul class="nav navbar-nav navbar-right">
                            <li class="">
                                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <img src="images/user_img/{{user.user_session_id}}.jpg" alt=""> {{user.nombre}} {{user.apellidos}} 
                                    <span class=" fa fa-angle-down"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-usermenu animated fadeInDown pull-right">
                                    <li><a href="/logout"><i class="fa fa-sign-out pull-right"></i> Desconectar</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>

            </div>
            <!-- /top navigation -->


            <!-- page content -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="page-title">
                        <div class="title">
                            <h3>Consulta de Inconformidades</h3>
                            <br>
                        </div>

                        <div class="title_right">
                            <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                                <div class="input-group">
                        </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>

                    <div class="">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Tabla de registros de inconformidades</h2>
                                    
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <table id="example" class="table table-striped responsive-utilities jambo_table bulk_action">
                                        <thead>
                                            <tr class="headings">
                                                <th>
                                                    
                                                </th>
                                                <th>Nombre </th>
                                                <th>Apellidos </th>
                                                <th>Respondida</th>
                                                <th>Ubicación Laboral asignada </th>
                                                <th>Inconformidad</th>
                                                <th style="display:none">Encabezado oculto</th>
                                                <th style="display:none">Encabezado oculto</th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            {{#each table}}
                                            <tr class="even pointer">
                                                <td class="a-center ">
                                                    <input type="checkbox" name="table_records" value="{{userid}}" class="tableflat">
                                                </td>
                                                <td class=" ">{{nombre}}</td>
                                                <td class=" ">{{apellidos}}</td>
                                                <td class=" ">{{respondida}}</td>
                                                <td class=" ">{{ubicacion_laboral}}</td>
                                                <td class=" last">{{inconformidad}}</td>
                                                <td style="display: none;" >{{inconformidad}}</td>
                                                <td style="display: none;" >{{respuesta}}</td>
                                            </tr>
                                            {{/each}}
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="">
                    
                        <div class="col-md-6 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Inconformidad del estudiante <small></small></h2>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content collapse collapsable">
                                    <form action=""></form>
                                     <label for="message"></label>
                                     <textarea id="inconf_textarea" class="form-control" disabled name="inconf"></textarea>
                                     <br/>
                                    </form>
                                </div>
                            </div>
                        </div>
                    
                        
                        <div id="resp" class="col-md-6 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Redactar respuesta <small></small></h2>
                                    
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content collapse collapsable_b">
                                    <form action="" method="post">
                                     <input type="hidden" name="userid" id="user_id" >
                                     <input type="hidden" name="nombre_profesor" value="{{user.nombre}} {{user.apellidos}}" >
                                     <label for="respuesta">Redacte su respuesta a la inconformidad :</label>
                                     <textarea id="respuesta" required class="form-control" name="respuesta" ></textarea>
                                     <br/>
                                     <button id="form-submit" type="submit" class="btn btn-primary"> Guardar Cambios </button>
                                    </form>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            <!-- footer content -->
                <footer>
                    <div class="">
                        <p class="pull-right"> Sistema de Gestión de Egresados de la Facultad 4 de la <a href="https://www.uci.cu">UCI</a> <a href="mailto:stephanhp@estudiantes.uci.cu;ransetmv@estudiantes.uci.cu;osmanibm@estudiantes.uci.cu"> Equipo de Ingeniería de Software II</a>.
                            <span class="lead"> <i class="glyphicon glyphicon-education"></i> EGREX</span>
                        </p>
                    </div>
                    <div class="clearfix"></div>
                </footer>
                <!-- /footer content -->
            </div>
            <!-- /page content -->

        </div>

    </div>

        <!-- Manipular datos -->
        <script>
            $(document).ready(function() {
                // Obtiene una referencia a todos los checkboxes de la tabla
                var checkboxes = $('input[name="table_records"]');
                const $panel = $('.collapsable');
                const $panel_b = $('.collapsable_b');
                // Escucha el evento click en los checkboxes
                checkboxes.on('click', function() {
                        $panel_b.removeClass('show').addClass('collapse');
                        $panel.removeClass('show').addClass('collapse');
                    // Si el checkbox está seleccionado, desmarca los demás checkboxes y rellenar form
                    if ($(this).prop('checked')) {
                        $panel.removeClass('collapse').addClass('show');
                        $panel_b.removeClass('collapse').addClass('show');
                        $('#respuesta').val( '' );
                        $('#form-submit').show();
                        $('#respuesta').prop('disabled', false);
                        for (var i = 0; i < checkboxes.length; i++) {
                            if (checkboxes[i] !== this) {
                                checkboxes[i].checked = false;
                            }
                        }
                        const $fila = $(this).closest('tr');
                        const id = $(this).val();
                        const answ = $fila.find('td:nth-of-type(7)').text();
                        const answ_yet = $fila.find('td:nth-of-type(4)').text();
                        $('#user_id').val(id);
                        $('#inconf_textarea').val(answ);
                        if (answ_yet === 'Si'){
                            $('#respuesta').val( $fila.find('td:nth-of-type(8)').text() );
                            $('#form-submit').hide();
                            $('#respuesta').prop('disabled', true);
                        }
                    } else {
                        $panel_b.removeClass('show').addClass('collapse');
                        $panel.removeClass('show').addClass('collapse');
                        $('#respuesta').val( '' );
                        $('#form-submit').show();
                        $('#respuesta').prop('disabled', false);
                    }
                });
            });
            
        </script>

    <script>

     var asInitVals = new Array();
     $(document).ready(function () {
         var oTable = $('#example').dataTable({
             "oLanguage": {
                 "sEmptyTable": "No hay datos para mostrar",
                 "sSearch": "Búsqueda rápida:"
             },
             "aoColumnDefs": [
                 {
                     'bSortable': false,
                     'aTargets': [0]
                 } //disables sorting for column one
     ],
             'iDisplayLength': 4,
                    "sPaginationType": "full_numbers",
                    "dom": 'T<"clear">lfrtip',
                    drawCallback: function(settings) {
                     $('select[name="example_length"]').prepend('<option value="4">4</option>');
                     $('select[name="example_length"]').val( settings._iDisplayLength );
                     }
         });
         $("tfoot input").keyup(function () {
             /* Filter on the column based on the index of this element's parent <th> */
             oTable.fnFilter(this.value, $("tfoot th").index($(this).parent()));
         });
         $("tfoot input").each(function (i) {
             asInitVals[i] = this.value;
         });
         $("tfoot input").focus(function () {
             if (this.className == "search_init") {
                 this.className = "";
                 this.value = "";
             }
         });
         $("tfoot input").blur(function (i) {
             if (this.value == "") {
                 this.className = "search_init";
                 this.value = asInitVals[$("tfoot input").index(this)];
             }
         });
        });
    </script>

    <script>
        $(document).ready(function(){
            var longitudMaxima = 25;
            $('td.last').each(function(){
            var texto = $(this).text();
            if (texto.length > longitudMaxima) {
            var textoRecortado = texto.substring(0, longitudMaxima) + '...';
            $(this).text(textoRecortado);
            }   });
        });
    </script>

    <!-- /footer content -->
</body>
